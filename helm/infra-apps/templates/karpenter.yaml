apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: karpenter
  namespace: argocd
spec:
  project: default

  source:
    repoURL: https://github.com/matanmiz1/argocd-super.git
    targetRevision: HEAD
    path: helm/karpenter
    helm:
      valuesObject:
        # nodeSelector:
        #   eks.amazonaws.com/nodegroup: # TODO: change terraform to have name to initial node group
        clusterName: ie-test-eks
        EC2NodeClass:
          role: ie-test-eks-nodes-group
        karpenter:
          settings:
            clusterName: ie-test-eks
            clusterEndpoint: https://16183A0B2CD4BAD75C6DCA91529B056F.yl4.eu-west-1.eks.amazonaws.com
            interruptionQueue: Karpenter-ie-test-eks
          serviceAccount:
            annotations:
              eks.amazonaws.com/role-arn: arn:aws:iam::883241448326:role/KarpenterControllerRole-ie-test-eks
  destination:
    server: {{ .Values.spec.destination.server }}
    namespace: karpenter

  syncPolicy:
    syncOptions:
    - CreateNamespace=true

    automated:
      selfHeal: true
      prune: true
